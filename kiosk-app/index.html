<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0a0a0f">
    <title>Avatar Hologr√°fico</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/svg+xml" href="assets/icon.svg">
    <link rel="apple-touch-icon" href="assets/icon.svg">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Pantalla de inicio -->
    <div id="splash-screen" class="screen active">
        <div class="splash-content">
            <div class="hologram-ring"></div>
            <h1 class="glow-text">AVATAR HOLOGR√ÅFICO</h1>
            <p>Toca para comenzar</p>
        </div>
    </div>

    <!-- Men√∫ principal -->
    <div id="main-menu" class="screen">
        <header>
            <h1>Selecciona una experiencia</h1>
        </header>

        <div class="mode-grid">
            <div class="mode-card" data-mode="memorial">
                <div class="mode-icon">üì∏</div>
                <h2>Foto Memorial</h2>
                <p>Anima una foto y t√≥mate una selfie con el holograma</p>
            </div>

            <div class="mode-card" data-mode="receptionist">
                <div class="mode-icon">üéôÔ∏è</div>
                <h2>Asistente Virtual</h2>
                <p>Habla con nuestro asistente hologr√°fico</p>
            </div>

            <div class="mode-card" data-mode="menu">
                <div class="mode-icon">üçΩÔ∏è</div>
                <h2>Men√∫ Interactivo</h2>
                <p>Explora nuestros platillos en 3D</p>
            </div>

            <div class="mode-card" data-mode="catalog">
                <div class="mode-icon">üëó</div>
                <h2>Cat√°logo</h2>
                <p>Descubre productos con ayuda virtual</p>
            </div>

            <div class="mode-card" data-mode="videocall">
                <div class="mode-icon">üìπ</div>
                <h2>Videollamada</h2>
                <p>Conecta con una persona real</p>
            </div>
        </div>

        <footer>
            <div class="status-bar">
                <span id="connection-status" class="status-indicator offline">‚óè Desconectado</span>
                <span id="device-status">Sin dispositivo</span>
            </div>
        </footer>
    </div>

    <!-- Modo Memorial -->
    <div id="memorial-screen" class="screen mode-screen">
        <header>
            <button class="back-btn" data-back="main-menu">‚Üê</button>
            <h1>Foto Memorial</h1>
        </header>

        <div class="memorial-content">
            <div id="memorial-step-1" class="memorial-step active">
                <div class="upload-area" id="upload-area">
                    <div class="upload-icon">üì∑</div>
                    <h2>Sube una foto</h2>
                    <p>Toca aqu√≠ o arrastra una imagen</p>
                    <input type="file" id="photo-input" accept="image/*" capture="environment">
                </div>
                <div id="photo-preview" class="photo-preview hidden">
                    <img id="preview-img" src="" alt="Preview">
                    <button class="btn-secondary" id="change-photo">Cambiar foto</button>
                </div>
                <button class="btn-primary" id="generate-avatar" disabled>Generar Avatar</button>
            </div>

            <div id="memorial-step-2" class="memorial-step">
                <div class="processing-animation">
                    <div class="spinner"></div>
                    <h2>Creando tu avatar...</h2>
                    <p id="processing-status">Detectando rostro...</p>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                </div>
            </div>

            <div id="memorial-step-3" class="memorial-step">
                <div class="success-message">
                    <div class="success-icon">‚ú®</div>
                    <h2>¬°Avatar listo!</h2>
                    <p>Tu avatar est√° proyect√°ndose en el holograma</p>
                </div>
                <div class="action-buttons">
                    <button class="btn-primary" id="take-selfie">üì∏ Tomar Foto</button>
                    <button class="btn-secondary" id="replay-avatar">üîÑ Repetir</button>
                </div>
                <div id="camera-preview-container" class="hidden">
                    <video id="selfie-video" autoplay playsinline muted></video>
                    <div class="camera-actions">
                        <button class="btn-primary" id="capture-photo-btn">üì∏ Capturar</button>
                        <button class="btn-secondary" id="cancel-camera-btn">‚úï Cancelar</button>
                    </div>
                </div>
                <canvas id="selfie-canvas" class="hidden"></canvas>
                <div id="selfie-preview" class="hidden">
                    <img id="selfie-img" src="" alt="Selfie">
                    <div class="selfie-actions">
                        <button class="btn-primary" id="save-selfie">üíæ Guardar</button>
                        <button class="btn-secondary" id="retake-selfie">üîÑ Otra vez</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modo Recepcionista -->
    <div id="receptionist-screen" class="screen mode-screen">
        <header>
            <button class="back-btn" data-back="main-menu">‚Üê</button>
            <h1>Asistente Virtual</h1>
        </header>

        <div class="chat-container">
            <div class="avatar-display">
                <div class="avatar-status">
                    <span class="pulse-dot"></span>
                    <span>Avatar activo</span>
                </div>
            </div>

            <div class="chat-messages" id="chat-messages">
                <div class="message assistant">
                    <p>¬°Hola! Soy tu asistente virtual. ¬øEn qu√© puedo ayudarte?</p>
                </div>
            </div>

            <div class="chat-input-area">
                <button class="mic-button" id="mic-button">
                    <span class="mic-icon">üé§</span>
                    <span class="mic-text">Mant√©n presionado para hablar</span>
                </button>
                <div class="text-input-row">
                    <input type="text" id="text-input" placeholder="O escribe tu mensaje...">
                    <button class="send-button" id="send-button">‚û§</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modo Men√∫ -->
    <div id="menu-screen" class="screen mode-screen">
        <header>
            <button class="back-btn" data-back="main-menu">‚Üê</button>
            <h1>Men√∫ Interactivo</h1>
        </header>

        <div class="menu-container">
            <div class="categories-bar" id="categories-bar">
                <!-- Categor√≠as din√°micas -->
            </div>

            <div class="menu-items" id="menu-items">
                <!-- Items din√°micos -->
            </div>

            <div class="item-detail hidden" id="item-detail">
                <div class="item-detail-content">
                    <button class="close-detail" id="close-detail">‚úï</button>
                    <img id="detail-image" src="" alt="">
                    <h2 id="detail-name"></h2>
                    <p id="detail-description"></p>
                    <div class="detail-price" id="detail-price"></div>
                    <div class="detail-actions">
                        <button class="btn-primary" id="show-in-hologram">
                            ‚ú® Ver en Holograma
                        </button>
                        <button class="btn-secondary" id="play-video">
                            ‚ñ∂Ô∏è Ver Preparaci√≥n
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modo Cat√°logo -->
    <div id="catalog-screen" class="screen mode-screen">
        <header>
            <button class="back-btn" data-back="main-menu">‚Üê</button>
            <h1>Cat√°logo</h1>
        </header>

        <div class="catalog-container">
            <div class="search-bar">
                <input type="text" id="product-search" placeholder="üîç Buscar productos...">
            </div>

            <div class="filter-bar" id="filter-bar">
                <button class="filter-chip active" data-filter="all">Todos</button>
                <!-- Filtros din√°micos -->
            </div>

            <div class="products-grid" id="products-grid">
                <!-- Productos din√°micos -->
            </div>

            <div class="product-detail hidden" id="product-detail">
                <div class="product-detail-content">
                    <button class="close-detail" id="close-product-detail">‚úï</button>
                    <div class="product-images" id="product-images">
                        <!-- Galer√≠a de im√°genes -->
                    </div>
                    <h2 id="product-name"></h2>
                    <p id="product-description"></p>
                    <div class="product-price" id="product-price"></div>
                    <div class="product-options">
                        <div class="option-group">
                            <label>Talla:</label>
                            <div class="size-buttons" id="size-buttons"></div>
                        </div>
                        <div class="option-group">
                            <label>Color:</label>
                            <div class="color-buttons" id="color-buttons"></div>
                        </div>
                    </div>
                    <div class="stock-status" id="stock-status"></div>
                    <button class="btn-primary" id="show-product-hologram">
                        ‚ú® Ver en Holograma 3D
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modo Videollamada -->
    <div id="videocall-screen" class="screen mode-screen">
        <header>
            <button class="back-btn" data-back="main-menu">‚Üê</button>
            <h1>Videollamada</h1>
        </header>

        <div class="videocall-container">
            <div id="videocall-idle" class="videocall-state active">
                <div class="videocall-icon">üìπ</div>
                <h2>Videollamada en Vivo</h2>
                <p>Conecta con una persona real que aparecer√° en el holograma</p>
                <input type="text" id="caller-id" placeholder="Tu nombre o ID">
                <button class="btn-primary" id="start-call">Iniciar Llamada</button>
            </div>

            <div id="videocall-connecting" class="videocall-state">
                <div class="spinner"></div>
                <h2>Conectando...</h2>
                <p>Esperando conexi√≥n</p>
            </div>

            <div id="videocall-active" class="videocall-state">
                <div class="call-info">
                    <span class="call-duration" id="call-duration">00:00</span>
                    <span class="call-status">‚óè En llamada</span>
                </div>
                <video id="local-video" autoplay muted playsinline></video>
                <!-- Preview de simulaci√≥n (lo que se enviar√≠a al ventilador) -->
                <div id="simulation-preview" class="simulation-preview hidden">
                    <div class="simulation-label">Vista previa del ventilador</div>
                    <canvas id="simulation-canvas" width="224" height="224"></canvas>
                    <div class="simulation-info">
                        <span id="sim-fps">0 FPS</span>
                        <span id="sim-frames">0 frames</span>
                    </div>
                </div>
                <div class="call-controls">
                    <button class="control-btn" id="toggle-mic">üé§</button>
                    <button class="control-btn end-call" id="end-call">üìû</button>
                    <button class="control-btn" id="toggle-camera">üì∑</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de configuraci√≥n -->
    <div id="settings-modal" class="modal hidden">
        <div class="modal-content">
            <h2>Configuraci√≥n</h2>
            <div class="setting-group">
                <label>Servidor API:</label>
                <input type="text" id="api-url" value="http://localhost:8000">
            </div>
            <div class="setting-group">
                <label>Dispositivo (IP):</label>
                <input type="text" id="device-ip" value="192.168.4.1">
            </div>
            <div class="setting-group">
                <label>Idioma:</label>
                <select id="language">
                    <option value="es">Espa√±ol</option>
                    <option value="en">English</option>
                </select>
            </div>
            <div class="setting-group simulation-toggle">
                <label>
                    <input type="checkbox" id="simulation-mode">
                    <span>Modo Simulaci√≥n</span>
                </label>
                <p class="setting-hint">Prueba sin ventilador f√≠sico. Muestra preview de lo que se enviar√≠a al dispositivo.</p>
            </div>
            <div class="modal-actions">
                <a href="admin.html" class="btn-admin">‚öôÔ∏è Panel de Administraci√≥n</a>
                <button class="btn-secondary" id="close-settings">Cancelar</button>
                <button class="btn-primary" id="save-settings">Guardar</button>
            </div>
        </div>
    </div>

    <!-- Bot√≥n de configuraci√≥n flotante -->
    <button class="settings-fab" id="settings-fab">‚öôÔ∏è</button>

    <script src="js/api.js"></script>
    <script src="js/app.js"></script>
    <script>
        // Registrar Service Worker para PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(reg => console.log('SW registrado:', reg.scope))
                .catch(err => console.log('SW error:', err));
        }
    </script>
</body>
</html>
